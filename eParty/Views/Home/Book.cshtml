@model eParty.Models.HomeViewModel
@using Newtonsoft.Json
@{
    ViewBag.Title = "Đặt";
    Layout = "~/Views/Shared/LayoutUser.cshtml";
}
<div class="container-fluid contact py-6 wow bounceInUp" data-wow-delay="0.1s">
    <div class="container">
        <div class="row g-0">
            <div class="col-1">
                <img src="/Content/landingpage/img/background-site.jpg" class="img-fluid h-100 w-100 rounded-start" style="object-fit: cover; opacity: 0.7;" alt="">
            </div>
            <div class="col-10">
                <div class="border-bottom border-top border-primary bg-light py-5 px-4">
                    <div class="text-center">
                        <small class="d-inline-block fw-bold text-dark text-uppercase bg-light border border-primary rounded-pill px-4 py-1 mb-3">Đặt dịch vụ</small>
                        <h1 class="display-5 mb-5">Bạn muốn chúng tôi phục vụ ở đâu?</h1>
                    </div>
                    <div class="row g-4 form">
                        <div class="col-lg-4 col-md-6">
                            <select class="form-select border-primary p-2" aria-label="Default select example">
                                <option selected>Chọn quốc gia</option>
                                <option value="1">Việt Nam</option>
                                <option value="2">Anh</option>
                                <option value="3">Ấn Độ</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select class="form-select border-primary p-2" aria-label="Default select example">
                                <option selected>Chọn thành phố</option>
                                <option value="1">Tùy thuộc vào quốc gia</option>
                                <option value="2">London</option>
                                <option value="3">Mumbai</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select class="form-select border-primary p-2" aria-label="Default select example">
                                <option selected>Chọn địa điểm</option>
                                <option value="1">Tùy thuộc vào quốc gia</option>
                                <option value="2">London</option>
                                <option value="3">Mumbai</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select class="form-select border-primary p-2" aria-label="Default select example">
                                <option selected>Sự kiện nhỏ</option>
                                <option value="1">Loại sự kiện</option>
                                <option value="2">Sự kiện lớn</option>
                                <option value="3">Sự kiện nhỏ</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select class="form-select border-primary p-2" aria-label="Default select example">
                                <option selected>Số lượng khách</option>
                                <option value="1">100-200</option>
                                <option value="2">300-400</option>
                                <option value="3">500-600</option>
                                <option value="4">700-800</option>
                                <option value="5">900-1000</option>
                                <option value="6">1000+</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <select class="form-select border-primary p-2" aria-label="Default select example">
                                <option selected>Ăn chay</option>
                                <option value="1">Ăn chay</option>
                                <option value="2">Không chay</option>
                            </select>
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <input type="mobile" class="form-control border-primary p-2" placeholder="Số điện thoại của bạn">
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <input type="date" class="form-control border-primary p-2" placeholder="Chọn ngày">
                        </div>
                        <div class="col-lg-4 col-md-6">
                            <input type="email" class="form-control border-primary p-2" placeholder="Nhập email của bạn">
                        </div>
                        <div class="col-12 text-center">

                            <button type="submit" class="btn btn-primary px-5 py-3 rounded-pill">Gửi ngay</button>

                            <button type="button" class="btn btn-success px-5 py-3 rounded-pill ms-3" data-bs-toggle="modal" data-bs-target="#plannedModal">
                                Tôi đã có kế hoạch
                            </button>

                            <!-- Modal -->
                            <div class="modal fade" id="plannedModal" tabindex="-1" aria-labelledby="plannedModalLabel" aria-hidden="true">
                                <div class="modal-dialog modal-xl modal-dialog-centered">
                                    <div class="modal-content">
                                        <div class="modal-header">
                                            <h5 class="modal-title" id="plannedModalLabel">Chi tiết menu</h5>
                                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                                        </div>
                                        <div class="modal-body">
                                            <!-- Tabs -->
                                            <ul class="nav nav-tabs mb-3" id="menuTab" role="tablist">
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link active" id="menu-tab" data-bs-toggle="tab" data-bs-target="#menu" type="button">Menu</button>
                                                </li>
                                                <li class="nav-item" role="presentation">
                                                    <button class="nav-link" id="custom-tab" data-bs-toggle="tab" data-bs-target="#custom" type="button">Custom</button>
                                                </li>
                                            </ul>

                                            <div class="tab-content" id="menuTabContent">
                                                <!-- Menu sẵn có -->
                                                <div class="tab-pane fade show active" id="menu">
                                                    <div class="row">
                                                        <div class="col-12">
                                                            <div id="menuList" class="d-flex gap-2 overflow-auto">
                                                                @foreach (var menu in Model.Menus)
                                                                {
                                                                    <div class="card p-2" style="min-width:150px" data-menu-id=" @menu.Id ">
                                                                        @menu.Name
                                                                    </div>
                                                                }
                                                            </div>
                                                        </div>
                                                    </div>
                                                    <!-- Pagination -->
                                                    <nav class="mt-3">
                                                        <ul id="pagination" class="pagination justify-content-center"></ul>
                                                    </nav>

                                                </div>

                                                <!-- Custom menu -->
                                                <div class="tab-pane fade" id="custom">
                                                    <div class="row">
                                                        <div class="col-6">
                                                            <h6>Menu của bạn</h6>
                                                            <div id="customMenu" class="border p-2" style="min-height:320px;">
                                                                <!-- Nơi hiển thị món đã thêm -->
                                                            </div>
                                                        </div>
                                                        <div class="col-6">
                                                            <h6>Danh sách món ăn</h6>
                                                            <div id="foodList" class="row g-3"></div>

                                                            <nav>
                                                                <ul id="pagination" class="pagination justify-content-center mt-3"></ul>
                                                            </nav>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>

                                            <div class="modal-footer">
                                                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Đóng</button>
                                                <button type="button" class="btn btn-primary">Xác nhận</button>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>

                        </div>
                    </div>
                </div>
                <div class="col-1">
                    <img src="/Content/landingpage/img/background-site.jpg" class="img-fluid h-100 w-100 rounded-end" style="object-fit: cover; opacity: 0.7;" alt="">
                </div>
            </div>
        </div>
    </div>
    <script>
        // JS thêm món vào custom menu
        document.querySelectorAll('.food-item').forEach(btn => {
            btn.addEventListener('click', () => {
                const menu = document.getElementById('customMenu');
                const newItem = document.createElement('div');
                newItem.textContent = btn.textContent;
                newItem.className = 'border p-1 mb-1';
                menu.appendChild(newItem);
            });
        });
    </script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <div id="foodList" class="d-flex flex-column gap-2"></div>

    <nav>
        <ul id="pagination" class="pagination"></ul>
    </nav>

    <div id="foodList" class="d-flex flex-wrap gap-3"></div>

    <nav>
        <ul id="pagination" class="pagination"></ul>
    </nav>

    <script>
    const foods = @Html.Raw(JsonConvert.SerializeObject(Model.DtoFoods));

const itemsPerPage = 6;
let currentPage = 1;
let selectedMenuId = null; // menu sẵn có được chọn

const foodListEl = document.getElementById("foodList");
const paginationEl = document.getElementById("pagination");
const customMenuEl = document.getElementById("customMenu");

// Render món ăn
function renderFoods(page) {
    foodListEl.innerHTML = "";
    const start = (page - 1) * itemsPerPage;
    const end = start + itemsPerPage;
    const foodsToShow = foods.slice(start, end);

    foodsToShow.forEach(food => {
        const col = document.createElement("div");
        col.className = "col-4";

        const card = document.createElement("div");
        card.className = "card text-center p-2 food-item";
        card.style.width = "150px";
        card.style.margin = "0 auto";
        card.style.cursor = "pointer";

        const img = document.createElement("img");
        if (food.ImageUrl && !food.ImageUrl.startsWith("http") && !food.ImageUrl.startsWith("data:")) {
            img.src = "data:image/png;base64," + food.ImageUrl;
        } else {
            img.src = food.ImageUrl;
        }
        img.className = "card-img-top";
        img.style.width = "100%";
        img.style.height = "100px";
        img.style.objectFit = "cover";

        const title = document.createElement("div");
        title.textContent = food.Name;
        title.className = "mt-2";

        card.appendChild(img);
        card.appendChild(title);
        col.appendChild(card);
        foodListEl.appendChild(col);

        // Click thêm món vào custom menu
        card.addEventListener('click', () => {
            const newItem = document.createElement('div');
            newItem.textContent = food.Name;
            newItem.className = 'border p-1 mb-1';
            customMenuEl.appendChild(newItem);
        });
    });
}

// Render phân trang
function renderPagination() {
    paginationEl.innerHTML = "";

    const prevLi = document.createElement("li");
    prevLi.className = "page-item" + (currentPage === 1 ? " disabled" : "");
    const prevA = document.createElement("a");
    prevA.className = "page-link";
    prevA.href = "#";
    prevA.textContent = "‹";
    prevA.addEventListener("click", (e) => {
        e.preventDefault();
        if (currentPage > 1) {
            currentPage--;
            renderFoods(currentPage);
            renderPagination();
        }
    });
    prevLi.appendChild(prevA);
    paginationEl.appendChild(prevLi);

    for (let i = 1; i <= Math.ceil(foods.length / itemsPerPage); i++) {
        const li = document.createElement("li");
        li.className = "page-item" + (i === currentPage ? " active" : "");
        const a = document.createElement("a");
        a.className = "page-link";
        a.href = "#";
        a.textContent = i;
        a.addEventListener("click", (e) => {
            e.preventDefault();
            currentPage = i;
            renderFoods(currentPage);
            renderPagination();
        });
        li.appendChild(a);
        paginationEl.appendChild(li);
    }

    const nextLi = document.createElement("li");
    nextLi.className = "page-item" + (currentPage === Math.ceil(foods.length / itemsPerPage) ? " disabled" : "");
    const nextA = document.createElement("a");
    nextA.className = "page-link";
    nextA.href = "#";
    nextA.textContent = "›";
    nextA.addEventListener("click", (e) => {
        e.preventDefault();
        if (currentPage < Math.ceil(foods.length / itemsPerPage)) {
            currentPage++;
            renderFoods(currentPage);
            renderPagination();
        }
    });
    nextLi.appendChild(nextA);
    paginationEl.appendChild(nextLi);
}

// Chọn menu sẵn có
document.querySelectorAll('#menuList .card').forEach(card => {
    card.style.cursor = "pointer";
    card.addEventListener('click', () => {
        // Bỏ highlight các menu khác
        document.querySelectorAll('#menuList .card').forEach(c => c.style.border = "1px solid #dee2e6");
        card.style.border = "2px solid green"; // highlight menu chọn
        selectedMenuId = card.dataset.menuId; // nếu muốn lưu id menu
    });
});

        document.querySelector('#plannedModal .btn-primary').addEventListener('click', () => {
            // Lấy tab hiện tại
            const activeTab = document.querySelector('#menuTabContent .tab-pane.active').id;

            if (activeTab === "menu") {
                // Tab menu sẵn có
                if (selectedMenuId) {
                    alert("Bạn đã chọn menu sẵn có.");
                } else {
                    alert("Bạn chưa chọn menu nào.");
                }
            } else if (activeTab === "custom") {
                // Tab custom
                if (customMenuEl.children.length > 0) {
                    alert("Bạn đã chọn menu custom với " + customMenuEl.children.length + " món ăn.");
                } else {
                    alert("Bạn chưa thêm món nào vào menu custom.");
                }
            }
        });

renderFoods(currentPage);
renderPagination();

    </script>


